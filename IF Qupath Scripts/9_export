   /*20240823 Elizabeth Dunn
    *Script to export measurements
    *Run â€£ Run for project for batch mode    
    */


    //exporting mesurements. Adjust the output folders here    
 
import qupath.lib.gui.tools.MeasurementExporter
import qupath.lib.objects.PathAnnotationObject //change to match what kind of data from image you are exporting

// Get the list of all images in the current project
def project = getProject()
def imagesToExport = project.getImageList()

// Separate each measurement value in the output file with a comma (",") to make csv can use "\t" for tab delimited
def separator = ","

// Choose the columns that will be included in the export
// Note: if 'columnsToInclude' is empty, all columns will be included
def columnsToInclude = new String[]{"Image", "Name", "Num spots estimated",\
"Cells detected in annotation", "NK cells detected in annotation", "T cells detected in annotation", "NK T cells detected in annotation", \
"Num IFNg+ cells", "Num IFNg+ NK cells", "Num IFNg+ T cells", "Num IFNg+ NK T cells", \
"Percentage IFNg+ cells of all cells", "Percentage NK cells of all cells", \
"Percentage IFNg+ NK cells of all IFNg+ cells", "Percentage IFNg+ NK cells of all NK cells", \
"Percentage T cells of all cells","Percentage IFNg+ T cells of all IFNg+ cells", "Percentage IFNg+ T cells of all T cells", \
"Percentage NK T cells of all cells", "Percentage IFNg+ NK T cells of all IFNg+ cells","Percentage IFNg+ NK T cells of all NK T cells",\
"Num cells no spot", "Percentage no spot cells of all cells", "Num cells one spot", "Percentage one spot cells of all cells", \
"Num cells 1-3 spot", "Percentage 1-3 spot cells of IFNg+ cells", "Num cells 4-9 spot", "Percentage 4-9 spot cells of IFNg+ cells", "Num cells 10-15 spot", "Percentage 10-15 spot cells of IFNg+ cells",  "Num cells >15 spot", "Percentage >15 spot cells of IFNg+ cells"
}

// Choose the type of objects that the export will process
// Other possibilities include:
//    1. PathAnnotationObject
//    2. PathDetectionObject
//    3. PathRootObject
// Note: import statements should then be modified accordingly
def exportType = PathAnnotationObject //change here to what you want to export (can be cells, annotation as a whole etc)


// Choose your *full* output path and change name of output .csv file
def outputPath = "M:/ElizabethD/FINAL MEASUREMENTS 20250227 post AF classifier.csv"
def outputFile = new File(outputPath)



// Create the measurementExporter and start the export
def exporter  = new MeasurementExporter()
                  .imageList(imagesToExport)            // Images from which measurements will be exported
                  .separator(separator)                 // Character that separates values
                  .includeOnlyColumns(columnsToInclude) // Columns are case-sensitive
                  .exportType(exportType)               // Type of objects to export
                //  .filter(obj -> obj.getPathClass() == getPathClass("Tumor"))    // Keep only objects with class 'Tumor'
                  .exportMeasurements(outputFile)        // Start the export process

print "Done!"
